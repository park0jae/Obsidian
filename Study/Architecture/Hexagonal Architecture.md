
헥사고날 아키텍처는 전통적인 계층형 아키텍처의 단점을 보완하기 위해 생겼다.
- 도메인 중심 아키텍처의 일종으로 클린 아키텍처를 일반화한 구조 중 하나이다.
- 포트와 어댑터(Ports and Adapters) 아키텍처라고도 말한다.

</br>
</br>
## 계층형 아키텍처의 문제점 

### 1) 데이터베이스(+ 영속성)에 대한 의존이 퍼진다.

- 전통적인 계층형 아키텍처의 도메인 계층은 영속성에 의존한다. 
- 즉, 도메인 계층이 자연스레 DB에 의존하게 되어 변화가 일어나면 도메인 계층도 변화가 생긴다
- 결과적으로 도메인 모델을 사용하는 서비스 계층에서도 즉시 로딩, 지연 로딩, 트랜잭션 등을 고려해야 하며, 영속성에 대한 의존이 프로젝트 전체적으로 퍼지게 되고 변경에 취약해진다.

</br>

### 2) 계층을 Skip 할 수 있다.
![[Pasted image 20240528192129.png]]

- 계층형 구조에서 많이 나타나는 형태로 계층을 건너뛰는 것이 가능하다.
- 간단하게 구현하는 경우 Controller에서 바로 도메인을 참조해서 로직을 작성할 수 있다.
- 이는 확장이 어려울 뿐만 아니라, 테스트가 복잡해진다.(영속성 계층도 Mocking 해야함)


### 3) 서비스의 크기를 강제할 수 없다.

- 계층형 구조에서는 서비스의 크기를 강제하지 않는다. 
- Service에 수십개의 서비스 로직을 전부 때려넣는 것도 가능해진다.
- 이런 경우 너무 많은 의존을 가져버리고, 수많은 Web 계층이 해당 Service를 의존하게 된다.
- 테스트가 어려워지며, 작업해야할 Use Case를 찾기도 힘들어진다.


</br>

## 클린 아키텍처 
![[Pasted image 20240528192408.png]]

클린 아키텍처에서는 비즈니스 규칙이 외부(DB, Framework, UI, 외부 System)로부터 독립적으로 만들어 테스트를 용이하게 하고, 비즈니스 규칙이 외부의 영향을 받지 않는 아키텍처이다.

이는, 도메인 코드가 바깥쪽으로 향하는 어떠한 의존성도 없어야 함을 의미한다. DIP의 도움으로 모든 의존성이 안쪽(도메인)을 향하고 있다.


</br>
</br>
## 헥사고날 아키텍처
![[Pasted image 20240528193720.png]]

- 헥사고날 아키텍처(육각형 아키텍처)는 클린 아키텍처를 일반화한 구조 중 하나이다.
- 사용자 인터페이스나 데이터베이스 모두 비즈니스 로직으로부터 분리해야 하는 외부 요소로 취급한다.
- 이는 비즈니스 로직이 외부 요소에 의존하지 않고 Presentation 계층과 Data Source 계층이 도메인 계층에 의존하도록 만들어야 한다는 것이다.

- 서론에서 헥사고날 아키텍처는 포트와 어댑터 아키텍처로 부르기도 한다고 했는데, 육각형의 바깥에는 애플리케이션과 상호작용하는 어댑터가 있다.
- 일부 어댑터는 외부 시스템과 상호작용하며, 데이터베이스와 상호작용하는 어댑터도 있다.

> 결국, 클린 아키텍처와 헥사고날 아키텍처 모두 의존성을 역전시켜 도메인 코드가 바깥쪽 코드에 의존하지 않게 함으로써 외부로부터 도메인 로직의 결합을 제거한다. 변경할 이유가 적을수록 유지보수성이 높은 코드가 된다.


</br>

### 어댑터(Adapter) ?

- 어댑터는 포트를 통해 애플리케이션 코어와 외부 세계를 연결한다.
- 특정 외부 기술이나, 프레임워크에 의존적인 로직을 담당한다.
- 애플리케이션 코어는 이를 통해 외부와 결합도를 최소화하고, 어댑터를 통한 교환 가능성을 확보한다.

- 종류
	- 인커밍 어댑터는 주로 사용자 인터페이스(UI), 외부 시스템으로부터 요청을 주도하는데 사용
		- ex. Controller
	- 아웃고잉 어댑터는 애플리케이션 코어에서 외부에 데이터를 전달하는 역할을 담당하는데 예를 들어, 데이터베이스에 데이터를 저장하거나 외부 시스템에 메세지를 전송하는 역할
		- ex. Repository


</br> 

### 포트(Port) ?

- 애플리케이션 코어의 경계를 정의하며 코어가 제공해야 할 기능을 나타내며, 어댑터를 통해 애플리케이션 코어에 접근하는 인터페이스
- 종류
	- 인커밍 포트는 외부 요청이 애플리케이션 코어로 들어오는 경로를 정의한다. 예를 들어 웹 요청, GUI 이벤트, 스케줄링 이벤트 등이 인커밍 포트를 통해 애플리케이션 포트를 들어올 수 있다.
		- Controller와 Service 사이의 인터페이스
	- 아웃고잉 포트는 애플리케이션 코어가 외부 세계에 서비스를 제공하기 위한 경로를 정의한다. 예를 들어 데이터베이스, 메세징 시스템 등에 데이터를 전송하거나 요청하는 경우 사용함
		- Repository와 Service 사이의 인터페이스



## 정리

헥사고날 아키텍처는 인커밍 어댑터, 인커밍 포트, 유스케이스, 아웃고잉 포트, 아웃고잉 어댑터를 활용하여 계층 간 결합도를 낮추고 응집도를 높이는 역할을 한다.

첫 째로, 인커밍 어댑터는 애플리케이션 코어에 접근하는 방법을 정의한다. 그리고 인커밍 포트를 통해 이루어진다. 인커밍 포트는 애플리케이션 코어와 인커밍 어댑터 간의 계약을 설정하고 이를 통해 애플리케이션 코어는 어댑터의 구체적인 구현에 의존하지 않게 되어 결합도를 낮추는데 기여한다.

둘 째로, 유스케이스는 비즈니스 로직으로 애플리케이션의 도메인 로직을 캡슐화한다. 유스케이스는 애플리케이션 코어에서 정의하고 이 로직은 특정 UI, 데이터베이스, 프레임워크 등과는 독립적이어야 한다. 이는 코어 로직의 응집도를 높이고 결합도를 줄이는데 도움이 된다.

마지막으로 아웃고잉 포트는 애플리케이션 코어가 외부 세계에 데이터를 전송하거나 명령을 내리는 방법을 정의한다. 아웃고잉 어댑터는 이 포트를 통해 외부와 통신하며, 이 방식으로 애플리케이션 코어는 외부 세계의 변화에 영향을 받지 않는다.

이런 방식으로 헥사고날 아키텍처는 애플리케이션 계층 간 결합도를 낮추고, 각 계층의 책임에 집중할 수 있게 응집도를 높인다. 이런 특징은 헥사고날 아키텍처가 유연하고 확장 가능하며 변경에 강한 애플리케이션을 구축하는데 도움이 된다.